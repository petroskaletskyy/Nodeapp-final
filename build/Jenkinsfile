pipeline{

    environment {
        imagename = "pskaletskyy/nodeapp-final"
        registryCredential = 'DockerHub'
        dockerImage = "pskaletskyy/nodeapp-final:latest"
    }

    agent any

    stages{
        stage('Cloning Git') {
            steps {
                git (branch: 'master', 
                url: 'git@github.com:petroskaletskyy/Nodeapp-final.git',
                credentialsId: 'petroskaletskyy-GitHub-key')
            }
        }
        stage ('Build Docker image') {
            steps {
                script {
                    dockerImage = docker.build(imagename, "-f ./build/Dockerfile .")
                }
            }
        }
        stage ('Push Docker image to DockerHub') {
            steps {
                script {
                    docker.withRegistry( '', registryCredential ) {
                        dockerImage.push()
                    }    
                }
            }
        }
    }
}